<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>商票详情</title>
  <link rel="stylesheet" href="lib/layui/css/layui.css">
</head>

<body>
  <h1 style="margin: 50px;">商票详情</h1>
  <form class="layui-form" action="" style="width: 500px;margin:20px 150px;">

    <div class="layui-form-item">
      <label class="layui-form-label">出票日期</label>
      <input disabled type="text" class="layui-input test-item" style="width: 190px;" placeholder="出票日期" id="issueDate">
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">汇票到期日</label>
      <input disabled type="text" class="layui-input test-item" style="width: 190px;" placeholder="汇票到期日"
        id="expireDate">
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">票据金额</label>
      <div class="layui-input-block">
        <input disabled type="number" min="100" name="title" lay-verify="" placeholder="票据金额，小写数字" autocomplete="off"
          class="layui-input" style="width: 190px;" id="price">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">交易合同号</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="交易合同号" autocomplete="off"
          class="layui-input" style="width: 190px;" id="contractNumber">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">能否转让</label>
      <div class="layui-input-block" style="width: 190px;">
        <input disabled type="text" name="title" lay-verify="" placeholder="交易合同号" autocomplete="off"
          class="layui-input" style="width: 190px;" id="giveWay">
      </div>
    </div>
    <label class="layui-form-label" style="width:100px;color: #009688">出票人信息：</label>
    <div class="layui-form-item">
      <label class="layui-form-label">全称</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="全称" autocomplete="off" class="layui-input"
          style="width: 190px;" id="issueUser">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">账号</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="账号" autocomplete="off" class="layui-input"
          style="width: 190px;" id="issueAccount">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">开户银行</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="开户银行" autocomplete="off" class="layui-input"
          style="width: 190px;" id="issueBank">
      </div>
    </div>
    <label class="layui-form-label" style="width:100px;color: #009688">收票人信息：</label>
    <div class="layui-form-item">
      <label class="layui-form-label">全称</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="全称" autocomplete="off" class="layui-input"
          style="width: 190px;" id="receiveUser">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">账号</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="账号" autocomplete="off" class="layui-input"
          style="width: 190px;" id="receiveAccount">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">开户银行</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="开户银行" autocomplete="off" class="layui-input"
          style="width: 190px;" id="receiveBank">
      </div>
    </div>
    <label class="layui-form-label" style="width:100px;color: #009688">出票保证信息：</label>
    <div class="layui-form-item">
      <label class="layui-form-label">保证人姓名</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="保证人姓名" autocomplete="off"
          class="layui-input" style="width: 190px;" id="ensurerName">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">保证人地址</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="保证人地址" autocomplete="off"
          class="layui-input" style="width: 190px;" id="ensurerAddress">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">保证日期</label>
      <input disabled type="text" class="layui-input test-item" style="width: 190px;" placeholder="保证日期"
        id="ensureDate">
    </div>
    <label class="layui-form-label" style="width:100px;color: #009688">承兑人信息：</label>
    <div class="layui-form-item">
      <label class="layui-form-label">全称</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="全称" autocomplete="off" class="layui-input"
          style="width: 190px;" id="acceptancerUser">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">开户行行号</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="全称" autocomplete="off" class="layui-input"
          style="width: 190px;" id="acceptancerBankNum">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">账号</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="账号" autocomplete="off" class="layui-input"
          style="width: 190px;" id="acceptancerAccount">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">开户行名称</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" placeholder="开户行名称" autocomplete="off"
          class="layui-input" style="width: 190px;" id="acceptancerBank">
      </div>
    </div>
    <label class="layui-form-label" style="width:100px;color: #009688">承兑信息：</label>
    <div class="layui-form-item">
      <label class="layui-form-label">出票人承诺</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" disabled value="本汇票请予以承兑，到期无条件付款" autocomplete="off"
          class="layui-input" style="width: 250px;" id="issuePromise">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">承兑人承兑</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" disabled value="本汇票已经承兑，到期无条件付款" autocomplete="off"
          class="layui-input" style="width: 250px;" id="acceptancerAcceptance">
      </div>
    </div>
    <label class="layui-form-label" style="width:100px;color: #009688">票据状态：</label>
    <div class="layui-form-item">
      <label class="layui-form-label">新建商票收票人确认</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" disabled value="本汇票已经承兑，到期无条件付款" autocomplete="off"
          class="layui-input" style="width: 250px;" id="confirmState">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">票据转让确认状态</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" disabled value="本汇票已经承兑，到期无条件付款" autocomplete="off"
          class="layui-input" style="width: 250px;" id="switchState">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">是否抵押</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" disabled value="本汇票已经承兑，到期无条件付款" autocomplete="off"
          class="layui-input" style="width: 250px;" id="mortgageState">
      </div>
    </div>
    <!-- <div class="layui-form-item">
      <label class="layui-form-label">冗余</label>
      <div class="layui-input-block">
        <input disabled type="text" name="title" lay-verify="" disabled value="冗余" autocomplete="off"
          class="layui-input" style="width: 250px;" id="冗余">
      </div>
    </div> -->
    <h2 style="margin:20px 0px;">申请：</h2>
    <div class="sq" id="sq">
      <div class="layui-btn" lay-submit lay-filter="formDemo" id="zr" style="">转让</div>
      <div class="layui-btn" lay-submit lay-filter="formDemo" id="tx" style="">贴现</div>
      <div class="layui-btn" lay-submit lay-filter="formDemo" id="dy" style="">抵押</div>
    </div>
  </form>

  <script src="lib/layui/layui.all.js"></script>
  <script src="lib/ajax.js"></script>
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <script>
    //由于模块都一次性加载，因此不用执行 layui.use() 来加载对应模块，直接使用即可：
    var id;;
    ! function () {
      var layer = layui.layer,
        form = layui.form;

    }();

    $(function () {
      // 接收
      var url = window.location.search;
      var urlResult = [];
      var arrUrl = url.substr(1).split("&");
      //遍历
      for (var j = 0; j < arrUrl.length; j++) {
        urlResult[j] = decodeURI(arrUrl[j].split("=")[1]);
      }
      id = urlResult[0];
      res = getRequest("http://localhost:8089/v1/ticket/ticketsById?ticketId=" + id);

      console.log(uid);
      console.log(res.data.ownerId);
      if (res.data.ownerId != null && res.data.ownerId != '') {
        var uid = JSON.parse(localStorage.getItem("user")).id;

        if (res.data.ownerId != uid) {
          $('#sq').hide();
          layer.msg('该商票没有使用权');
          //已被转让
        }
      }else if(res.data.mortgage=="已抵押"){
        $('#sq').hide();
          layer.msg('该商票已被抵押，没有使用权');
          //已抵押
      }

      $('#acceptancerAcceptance').val(res.data.acceptancerAcceptance);
      $('#acceptancerAccount').val(res.data.acceptancerAccount);
      $('#acceptancerBank').val(res.data.acceptancerBank);
      $('#acceptancerBankNum').val(res.data.acceptancerBankNum);
      $('#acceptancerUser').val(res.data.acceptancerUser);
      $('#ensureDate').val(res.data.ensureDate);
      $('#ensurerAddress').val(res.data.ensurerAddress);
      $('#ensurerName').val(res.data.ensurerName);
      $('#expireDate').val(res.data.expireDate);
      $('#giveWay').val(res.data.giveWay);
      $('#issueAccount').val(res.data.issueAccount);
      $('#issueBank').val(res.data.issueBank);
      $('#issueDate').val(res.data.issueDate);
      $('#issuePromise').val(res.data.issuePromise);
      $('#issueUser').val(res.data.issueUser);
      $('#price').val(res.data.price);
      $('#receiveAccount').val(res.data.receiveAccount);
      $('#receiveBank').val(res.data.receiveBank);
      $('#receiveUser').val(res.data.receiveUser);
      $('#contractNumber').val(res.data.contractNumber);
      $('#mortgageState').val(res.data.mortgage);
      if (res.data.confirm == 0 || res.data.confirm == '') {
        $('#confirmState').val('未确认');
      } else if (res.data.confirm == 1) {
        $('#confirmState').val('已确认');
      }
      if (res.data.switchConfirm == 0 || res.data.switchConfirm == '' || res.data.switchConfirm == null) {
        $('#switchState').val('未确认或未提交');
      } else if (res.data.switchConfirm == 1) {
        $('#switchState').val('已确认');
      }
    });

    //转让
    $(document).on("click", "#zr", function () {
      // //1. 获取id值
      var cid = id;
      // //2. 页面跳转
      location.href = "switchInfo.html?cid=" + cid;
    });
    //抵押
    $(document).on("click", "#dy", function () {
      // //1. 获取id值
      var cid = id;
      // //2. 页面跳转
      location.href = "mortgageInfo.html?cid=" + cid;
    });
    //贴现
    $('#tx').click(function () {
      var uid = JSON.parse(localStorage.getItem("user")).id;
      var json = {
        "ticketId": id,
        "userId": uid
      }
      console.log(json)
      var res = postRequest("http://localhost:8089/v1/ticket/doDiscount", json);
      //刷新余额
      if(res.success==true){
        var res1 = getRequest("http://localhost:8089/v1/ticket/getBalance?uid="+uid);
        var user1 = JSON.parse(localStorage.getItem("user"));
        user1.balance = res1.data;
        localStorage.setItem("user",JSON.stringify(user1));
      }
      layer.msg(res.msg);
      setTimeout(function () {
        location.reload();
      }, 1500);
    });

    // //承兑
    // $('#cd').click(function () {
    //   var uid = JSON.parse(localStorage.getItem("user")).id;
    //   var json = {
    //     "ticketId": id,
    //     "userId": uid
    //   }
    //   console.log(json)
    //   var res = postRequest("http://localhost:8089/v1/ticket/acceptance", json);
    //   //刷新余额
    //   if(res.success==true){
    //     var res1 = getRequest("http://localhost:8089/v1/ticket/getBalance?uid="+uid);
    //     var user1 = JSON.parse(localStorage.getItem("user"));
    //     user1.balance = res1.data;
    //     localStorage.setItem("user",JSON.stringify(user1));
    //   }
    //   layer.msg(res.msg);
    //   setTimeout(function () {
    //     location.reload();
    //   }, 1500);
    // });
  </script>
</body>

</html>